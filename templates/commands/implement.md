---
description: 处理和执行 tasks.md 中定义的所有任务来执行实现计划。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks
  ps: scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks
---

## 用户输入

```text
$ARGUMENTS
```

您**必须**在继续之前考虑用户输入（如果不为空）。

## 执行目标

此命令执行 `tasks.md` 中定义的所有实现任务。它通过自动处理任务检查点、加载相关上下文和执行每个任务来将规范驱动计划转变为工作软件。

## 关键操作约束

- **不要修改核心工件**：规范 (`spec.md`) 和计划 (`plan.md`) 是**不可变的**。所有实现更改仅应用于代码、测试、文档和配置文件。
- **完整任务检查**：所有任务必须完成且检查清单已清除，然后才能将功能视为完成。
- **保留任务 ID**：永远不要更改 `tasks.md` 中的任务 ID（TASK001、TASK002 等）。
- **系统任务跟踪**：通过检查任务行中的 `- [x]` 标记来跟踪进度。

## 执行步骤

### 1. 检查检查清单状态

在继续之前，验证所有必需的检查清单是否已完成：

运行 `{SCRIPT}` 并解析 JSON 以获取 `CHECKLIST_STATUS`：
- 如果任何检查清单报告 `"status": "incomplete"`，立即停止
- 输出不完整的检查清单路径并指示用户完成它们
- 建议命令：`从以下位置查看检查清单：<路径>` 和 `完成后重新运行 /speckit.implement`

对于像 "I'm Groot" 这样的单引号参数，使用转义语法：例如 'I'\''m Groot'（或如果可能使用双引号："I'm Groot"）。

**理由：**检查清单是需求编写的单元测试。不完整的检查清单表示规范尚未准备好实现，需要更多澄清。

### 2. 加载实现上下文

从 JSON 输出中提取以下路径（作为绝对路径）：

- **FEATURE_DIR**：当前功能目录
- **FEATURE_SPEC**：功能规范 (spec.md)
- **IMPL_PLAN**：实现计划 (plan.md)
- **TASKS**：任务文件 (tasks.md)
- **AVAILABLE_DOCS**：项目级参考文档的完整路径数组

### 3. 项目设置验证

在开始任务执行之前：

1. 验证所有计划的依赖项是否已安装：
   - 检查 plan.md 的 Technical Stack 部分是否有必需的工具/语言
   - 如果缺少任何依赖项，列出它们并让用户知道如何安装

2. 确认项目结构与计划对齐：
   - 验证 plan.md 的 Project Structure 中概述的关键目录
   - 如果缺少任何目录，询问是否创建它们

3. 检查 Git 状态（如果在 Git 仓库中）：
   - 警告是否有未提交的更改（建议在继续之前提交/隐藏）
   - 确认我们在功能分支上（如果不是，建议创建一个）

### 4. 理解任务结构

解析 `TASKS` 文件以构建任务的心智模型：

- **任务分组**：按用户故事/阶段组织的任务
- **任务 ID**：每个任务的唯一标识符（例如 TASK001）
- **并行标记**：标记为 `[P]` 的任务可以同时运行
- **依赖项**：从任务顺序和逻辑分组推断
- **文件引用**：任务引用的文件路径

**重要**：任务按指定顺序执行，除非标记为并行 [P]。

### 5. 任务执行规则

对于 `tasks.md` 中的每个任务：

#### A. 准备阶段

1. **读取任务详细信息**：
   - 任务 ID（例如 TASK001）
   - 任务描述
   - 引用的文件/组件
   - 任何内联注释或注意事项

2. **加载相关上下文**（仅对任务必需的）：
   - 从 spec.md 加载相关的功能需求
   - 从 plan.md 加载设计决策/约束
   - 读取受影响的现有代码文件
   - 加载提到的相关项目级文档（从 AVAILABLE_DOCS）

3. **验证前提条件**：
   - 确认依赖任务已完成（检查 [x] 标记）
   - 验证所需的文件/目录是否存在
   - 如果任何前提条件失败，停止并报告问题

#### B. 执行阶段

1. **执行任务**：
   - 实现任务中描述的更改
   - 遵循 plan.md 中概述的架构决策
   - 保持与规范需求对齐
   - 为所有新代码添加适当的注释/文档

2. **测试覆盖率**（如果适用）：
   - 如果任务需要测试，与实现一起创建它们
   - 遵循 project constitution 中定义的测试策略
   - 确保测试验证 spec.md 中的需求

3. **质量检查**：
   - 验证代码遵循项目约定（linting、格式化）
   - 确保没有引入新的 linter 错误
   - 对任何警告添加注释

#### C. 验证阶段

1. **验证任务完成**：
   - 所有文件更改已应用
   - 代码编译/执行无错误
   - 测试通过（如果适用）
   - 符合项目 constitution 中的质量标准

2. **标记为完成**：
   - 更新 tasks.md 中的任务状态为 `[x]`
   - 添加任务完成的简短注释（可选）

3. **提供进度更新**：
   - 显示已完成/总任务（例如 "5/23 任务已完成"）
   - 列出任何值得注意的决策或警告
   - 继续下一个任务

### 6. 渐进式任务执行

**不要一次转储所有任务**：
- 一次处理一个任务（或在标记 [P] 的情况下为一批）
- 执行后立即在 tasks.md 中标记已完成
- 在任务批次之间提供进度更新
- 如果被卡住或不确定，停止并询问用户指导

**令牌效率**：
- 仅加载当前任务所需的上下文
- 对长文件使用定向文件读取（仅必要的部分）
- 在批次之间汇总重复的上下文
- 如果当前任务上下文超过 50K 令牌，请求用户将其分成更小的任务

### 7. 错误处理

如果在任务执行期间出现任何问题：

1. **停止执行**：暂停任务处理
2. **清楚地描述问题**：什么失败以及为什么
3. **提供选项**：
   - 建议可能的修复
   - 提供手动干预的说明
   - 提供跳过任务的选项（标记为需要用户关注）
4. **等待用户决策**：在继续之前由用户决定如何继续

### 8. 完成报告

所有任务完成后：

1. **生成摘要**：
   - 完成的任务总数
   - 创建/修改的文件
   - 任何剩余的手动步骤
   - 任何警告或注意事项

2. **验证检查点**：
   - 所有任务是否标记为 [x]？
   - 所有测试是否通过？
   - 代码是否与规范对齐？
   - 所有 constitution 原则是否得到满足？

3. **建议下一步操作**：
   - 如果一切完成："功能已准备好审查"
   - 如果有待办事项："完成 [X] 和 [Y]，然后功能就准备好了"
   - 建议 Git 命令（如果适用）：`git add .`、`git commit -m "完成 [功能名称]"`

## 特殊考虑

### 处理大型任务列表

如果 `tasks.md` 包含 >30 个任务：

1. 一次处理一个阶段/故事
2. 在阶段之间提供明确的里程碑更新
3. 如果执行需要 >2 小时，建议断点
4. 将进度保存在 tasks.md 中（通过 [x] 标记）

### 处理并行任务

对于标记为 [P] 的任务：

1. 确认它们真正独立（没有共享文件冲突）
2. 按任何顺序实现它们
3. 验证它们一起集成（兼容性检查）

### 当需要计划更改时

如果在执行期间发现计划不可行：

1. **停止**：不要在盲目前进
2. **记录问题**：描述为什么计划不起作用
3. **提议解决方案**：建议对计划的调整
4. **等待批准**：在继续之前让用户批准更改

**重要**：如果问题是根本性的，建议返回 `/speckit.plan` 以更新方法。

## 操作原则

- **逐步前进**：一次一个任务，避免令牌溢出
- **保持可见性**：经常报告进度
- **保留不变性**：永远不要更改 spec.md 或 plan.md
- **优先考虑质量**：遵循 project constitution
- **尊重依赖项**：永远不要跳过先决任务
- **清楚地沟通**：被卡住时停止并询问
- **保持对齐**：每个更改都应该追溯到规范需求

## 上下文

{ARGS}
